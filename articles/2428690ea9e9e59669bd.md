---
title: "promise,async/awaitã«ã¤ã„ã¦"
emoji: "â³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["JavaScript","éåŒæœŸå‡¦ç†"]
published: true
---

[ç¾ä»£ã® JavaScript ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://ja.javascript.info/async)ã‚’ã‚‚ã¨ã«å­¦ç¿’ã—ãŸ

éåŒæœŸã«ã¤ã„ã¦ã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã¾ã¨ã‚ã‚‹
ãã®å‰ã«è»½ãé–¢æ•°ã®æ›¸ãæ–¹ã‚’å¾©ç¿’ã—ã¦ãŠã“ã†

# é–¢æ•°ã®æ›¸ãæ–¹ã«ã¤ã„ã¦

## é–¢æ•°å®£è¨€
```js
function é–¢æ•°å()
{
  //å‡¦ç†
}

//å‘¼ã³å‡ºã—
é–¢æ•°å();
```
é–¢æ•°å®£è¨€ã¯å®£è¨€ã‚ˆã‚Šå‰ã«ã€é–¢æ•°å‘¼ã³å‡ºã—ã®è¨˜è¿°ã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹

## é–¢æ•°å¼
```js
let å¤‰æ•°å = function()//ç„¡åé–¢æ•°
{
  //å‡¦ç†
}

//å‘¼ã³å‡ºã—
å¤‰æ•°å();
```
é–¢æ•°å¼ã«ã™ã‚‹ã¨Functionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã€é€šå¸¸ã®å¤‰æ•°å®šç¾©ã¨åŒã˜ã«ãªã‚Šã€é–¢æ•°å¼ã‚ˆã‚Šå‰ã«é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ããªã„

## ã‚¢ãƒ­ãƒ¼é–¢æ•°
```js
let å¤‰æ•°å = () => 
{
  å‡¦ç†;
}
//let å¤‰æ•°å = () => å‡¦ç†;

//å‘¼ã³å‡ºã—
å¤‰æ•°å();
```
ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’é–¢æ•°å¼ã«ã—ã¦ã„ã‚‹å½¢

# éåŒæœŸå‡¦ç†ã«ã¤ã„ã¦
- **åŒæœŸå‡¦ç†**ãƒ»ãƒ»ãƒ»ä¸Šã‹ã‚‰é †ã«å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ã²ã¨ã¤ã®å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§æ¬¡ã®å‡¦ç†ã¯è¡Œã‚ãªã„
- **éåŒæœŸå‡¦ç†**ãƒ»ãƒ»ãƒ»ã‚³ãƒ¼ãƒ‰ã‚’é †ç•ªã«å‡¦ç†ã—ã¦ã„ããŒã€ã²ã¨ã¤ã®éåŒæœŸå‡¦ç†ãŒçµ‚ã‚ã‚‹ã®ã‚’å¾…ãŸãšã«æ¬¡ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
  - éåŒæœŸå‡¦ç†ã§ã¯åŒæ™‚ã«å®Ÿè¡Œã—ã¦ã„ã‚‹å‡¦ç†ãŒè¤‡æ•°ã‚ã‚‹
  - JSã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éåŒæœŸå‡¦ç†

## callback
- å‘¼ã³å‡ºã—ãŸã„**é–¢æ•°**ã®å¼•æ•°ã«**åˆ¥ã®é–¢æ•°**ã‚’æ¸¡ã—ã€**é–¢æ•°**ã®ä¸­ã§**åˆ¥ã®é–¢æ•°**ã®å‡¦ç†ã‚’ç™ºç«ã•ã›ã‚‹æ–¹æ³•
  - é–¢æ•°ã®å¼•æ•°ã«é–¢æ•°ã‚’æ¸¡ã›ã‚‹ã€æ¸¡ã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¨å‘¼ã¶
  - åŒæœŸå‡¦ç†ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ãŒã‚ˆãã¨ã‚‰ã‚Œã¦ã„ãŸ
  - ç‰¹ã«åŒæœŸå‡¦ç†ã«ç›´æ¥é–¢ä¿‚ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ãŒã€callbackã‚’ä½¿ã„ã€åˆ¥ã®å‡¦ç†ã‚’é–¢æ•°ã§ã‚ˆã‚“ã§ã„ã‚‹
```js
// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
function hello(callback) {
  console.log('hello,');//é€šå¸¸ã“ã“ã§ä½•ã‚‰ã‹ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ã£ã¦å‡¦ç†ã‚’æ­¢ã‚(é…ã‚‰ã›ã¦)æ¬¡ã®callbackã‚’ç™ºç«ã•ã›ã‚‹ ğŸ‘‰ åŒæœŸå‡¦ç†ã®å®Ÿç¾
  callback();
}

let sampleCallback = function() {
  console.log('bye');
}

hello(sampleCallback);//sampleCallbackã¯é–¢æ•°

//å‡ºåŠ›çµæœï¼šhello,bye
```
ä¸Šè¨˜ã‚„ã‚Šæ–¹ã§åŒæœŸå‡¦ç†ã‚’å®Ÿç¾ã•ã›ã¦ã„ãŸãŒã€callbacké–¢æ•°ã®ä¸­ã«callbacké–¢æ•°ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒãµãˆãŸã‚Šã€ãã‚‚ãã‚‚æ›¸ãã«ãã„ã¨ã„ã†èƒŒæ™¯ã‚‚ã‚ã£ã¦ã€ä»Šã§ã¯ä¸‹è¨˜ã§èª¬æ˜ã™ã‚‹**async/await**ãŒä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„

## promise
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€ç¨®ã§ã€thenãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆã‚‹ã®ãŒç‰¹å¾´
ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã¯ã€ŒPromise ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯éåŒæœŸå‡¦ç†ã®æœ€çµ‚çš„ãªå®Œäº†å‡¦ç† (ã‚‚ã—ãã¯å¤±æ•—) ãŠã‚ˆã³ãã®çµæœã®å€¤ã‚’è¡¨ç¾ã—ã¾ã™ã€ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹
Promiseã¯ä¸‰ã¤ã®çŠ¶æ…‹ã‚’æŒã¤
ã€Œå¾…æ©Ÿ(pending)ã€ï¼šä¿ç•™ä¸­
ã€Œæº€è¶³(fullfilled)ã€ï¼šå‡¦ç†ãŒå®Œäº†
ã€Œæ‹’çµ¶(rejected)ã€ï¼šå‡¦ç†ã®ã‚¨ãƒ©ãƒ¼

promiseã®ä¸­ã®é–¢æ•°å‡¦ç†ãŒç¢ºå®šã™ã‚‹ã¾ã§ã¯promiseã«ã€Œå¾…æ©Ÿ(pending)ã€ã‚’æ¸¡ã—ã€æ¬¡ã®å‡¦ç†ã«è¡Œã‹ã›ãªã„ã“ã¨ãŒã§ãã‚‹ ğŸ‘‰ åŒæœŸå‡¦ç†ã®å®Ÿç¾
å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¨promiseã«resolve(value)ã‹reject(error)ã‚’è¿”ã—ã€ãã‚Œãã‚ŒpromiseãŒ
resolveãªã‚‰ã€Œæº€è¶³(fullfilled)ã€
rejectãªã‚‰ã€Œæ‹’çµ¶(rejected)ã€
ã®çŠ¶æ…‹ã¨ãªã‚‹

thenãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ãƒ»ãƒ»promiseã®å‡¦ç†ãŒç¢ºå®šã—ãŸéš›ã«å¼•æ•°ã«æ›¸ã„ãŸé–¢æ•°ã®å‡¦ç†ã‚’èµ°ã‚‰ã›ã€åŒæœŸå‡¦ç†ã‚’å®Ÿç¾ã§ãã‚‹

promiseã§å®Ÿè£…ã—ãŸåŒæœŸå‡¦ç†
```js
const result = fetch('ä½•ã‹ã—ã‚‰ã®url');//

result.then(function(response){
  console.log(response);
})

console.log(result);//å‘¼ã³å‡ºã—
```
1. fetchã¯promiseå‹ã‚’è¿”ã™(resolve)
ğŸ‘‰ å¤±æ•—ã—ãŸã‚‰catchæ§‹æ–‡ã§å–å¾—ã§ãã‚‹(reject)
2. promiseå‹ã¯thenãŒä½¿ç”¨ã§ãã€thenã¯promiseã®å‡¦ç†ãŒç¢ºå®šã—ãŸéš›ã«å¼•æ•°ã«æ›¸ã„ãŸé–¢æ•°ã®å‡¦ç†ã‚’èµ°ã‚‰ã›ã‚‹ã¨ã„ã†ã‚‚ã®

### ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„
```js
setTimeout(function(){
  console.log('1ç§’');
    setTimeout(function(){
      console.log('2ç§’');
        setTimeout(function(){
          console.log('3ç§’');
      },3000);
    },2000);
},1000);
```
### thenãƒã‚§ã‚¤ãƒ³
ã“ã£ã¡ã®æ–¹ãŒã‚¹ã‚±ãƒ¼ãƒ«ã—ã‚„ã™ã„
```js
// const sleep = ms => new Promise(resolve => setTimeout(resolve,ms));
function sleep (ms) {
  new Promise (function(resolve, reject) {
    setTimeout(resolve,ms);
  });
}

sleep(1000)
.then(() => console.log('1ç§’'))//resolveã«å…¥ã‚‹
.then(() => sleep(2000))
.then(() => console.log('3ç§’'))
.then(() => sleep(3000))
```

## async/await
promiseã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼
asyncã§å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã¯promiseã‚’è¿”ã™ãŸã‚ä¸‹è¨˜ã®ã‚ˆã†ã«.thenã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹

ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ãƒ»ãƒ»ãƒ»åŒã˜æ„å‘³ã ã‘ã©æ¥½ã«ã‹ã‘ã‚‹æ§‹æ–‡ã®ã“ã¨ ğŸ‘‰ ifã¨ä¸‰é …æ¼”ç®—å­ãªã©

```js
async function f() {
  return 'å‡¦ç†çµ‚äº†';
}

f().then(console.log); // å‡¦ç†çµ‚äº†
```

awaitã¯promiseãŒç¢ºå®šã—ãã®çµæœã‚’è¿”ã™ã¾ã§ã€JavaScriptã‚’å¾…æ©Ÿã•ã›ã‚‹

```js
async function f() {

  let promise = new Promise((resolve, reject) => {
    setTimeout(() => resolve('å‡¦ç†çµ‚äº†'), 1000)
  });

  let result = await promise; // promiseãŒè§£æ±ºã™ã‚‹ã¾ã§å¾…ã¡ã¾ã™

  console.log(result); // å‡¦ç†çµ‚äº†
}

f();
```
